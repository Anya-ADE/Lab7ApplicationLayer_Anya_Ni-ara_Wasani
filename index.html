<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 7 Application Layer</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>

    <img src="application.png" class="img-fluid" alt="Application Layer" width="400" height="400">

    <h1>JAVASCRIPT AND API'S</h1>

    <p>With basic knowledge of JavaScript and API's I can find out that:</p>

    <h2>Your Public IP Address</h2>
    <p id="ip">Fetching IP...</p>

    <h2>Your Location</h2>
    <p id="location">Fetching location...</p>

    <div>
        <img src="application2.png" class="img-fluid" alt="Application Layer" width="400" height="400">
    </div>

    <script>
        async function fetchIPandLocation() {
            try {
                const ipResponse = await fetch("https://api.ipify.org?format=json");
                const ipData = await ipResponse.json();
                document.getElementById("ip").textContent = ipData.ip;

                const locResponse = await fetch(`https://ipapi.co/${ipData.ip}/json/`);
                const locData = await locResponse.json();

                document.getElementById("location").textContent =
                    `${locData.city}, ${locData.region}, ${locData.country_name}`;
                /* ---- STEP 4: Get Weather Using Location ---- */
                const lat = locData.latitude;
                const lon = locData.longitude;

                const API_KEY = "476e8f887e769150eb3e16ac522fcb2e";

                const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`);
                const weatherData = await weatherResponse.json();

// Temperature in Celsius
                const tempC = weatherData.main.temp;

// Convert to Fahrenheit
                const tempF = (tempC * 9/5) + 32;

            document.getElementById("weather").textContent =`${weatherData.weather[0].description}, ${tempF.toFixed(1)}°F / ${tempC.toFixed(1)}°C`;


            } catch (error) {
                document.getElementById("ip").textContent = "Error retrieving IP";
                document.getElementById("location").textContent = "Location lookup failed";
                console.error(error);
            }
        }

        fetchIPandLocation();
        

    </script>

    <footer>
        <p>Done by Anya-ADE, Ni'ara W, and Wasani C</p>
    </footer>

</body>
</html>


